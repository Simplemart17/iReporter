language: node_js
node_js:
- "stable"
install:
  - npm install
cache:
  directories:
    - "node_modules"
services:
  - postgresql

env:
  global:
    - CC_TEST_REPORTER_ID=d91e82f9734cc9e588b7dcad24ef53ac6f9d9a75333c2b5c1d54c2444035adb0
    
before_script:
  - yarn global add nyc
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
  - psql -c 'create database travis_ci_test;' -U postgres
  - psql -c 'CREATE TABLE records(
    id SERIAL PRIMARY KEY,
    createdOn DATE DEFAULT CURRENT_DATE,
    title VARCHAR(128) NOT NULL,
    createdBy INTEGER NOT NULL,
    type VARCHAR(128),
    location VARCHAR(128) NOT NULL,
    status VARCHAR(128),
    images VARCHAR,
    videos VARCHAR,
    comment VARCHAR(128) NOT NULL
);'

  - psql -c 'CREATE TABLE users(
    id SERIAL PRIMARY KEY,
    firstname VARCHAR(128) NOT NULL,
    lastname VARCHAR(128) NOT NULL,
    othername VARCHAR(128) NOT NULL,
    email VARCHAR(128) UNIQUE NOT NULL,
    phoneNumber BIGINT,
    username VARCHAR(128) NOT NULL,
    registered TIMESTAMP,
    password VARCHAR(128) NOT NULL,
    isAdmin BOOLEAN default FALSE
  );'

script:
  - nyc --reporter=lcov yarn run test

after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

notifications:
  email: false
